---
<% # Make sure the local copy of the driver is loaded %>
<% lib = File.expand_path('../lib', __FILE__) %>
<% $LOAD_PATH.unshift(lib) unless $LOAD_PATH.include?(lib) %>

driver:
  name: docker
  provision_command: curl -L https://www.chef.io/chef/install.sh | bash

transport:
  name: docker

provisioner:
  name: dummy

platforms:
  - name: amazonlinux-2
  - name: ubuntu-16.04
  - name: ubuntu-18.04
  - name: fedora-latest
    driver:
      provision_command:
        - yum install libxcrypt-compat.x86_64 -y
        - curl -L https://www.chef.io/chef/install.sh | bash
  - name: centos-6
  - name: centos-7
  - name: oraclelinux-6
  - name: oraclelinux-7
  - name: debian-8
  - name: debian-9
  - name: windows-2019
    driver:
      provision_command:
        - powershell -ExecutionPolicy Bypass -NoLogo -Command . { iwr -useb https://omnitruck.chef.io/install.ps1 } ^| iex; install
        - powershell -Command $path=$env:Path + ';c:\opscode\chef\embedded\bin'; Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Environment\' -Name Path -Value $path
    driver_config:
      image: mcr.microsoft.com/windows/servercore:ltsc2019
      platform: windows
  - name: unknown
    driver:
      image: ubuntu:16.04
      platform: ubuntu
  - name: dockerfile
    driver:
      username: dockerfile
      password: dockerfile
      dockerfile: test/Dockerfile
      run_command: /sbin/init

suites:
  - name: default
    excludes:
      - arch
  - name: context
    excludes:
      - arch
    driver:
      build_context: false
  - name: capabilities
    includes:
      - debian-8
      - debian-9
      - ubuntu-16.04
      - ubuntu-18.04
    driver:
      provision_command:
        - curl -L https://www.chef.io/chef/install.sh | bash
        - apt-get install -y net-tools
      cap_drop:
        - NET_ADMIN
  - name: inspec
    excludes:
      - windows-2019
    driver:
      provision_command: true
    verifier:
      name: inspec
  - name: inspec-windows
    includes:
      - windows-2019
    driver:
      provision_command: echo 1
    verifier:
      name: inspec
